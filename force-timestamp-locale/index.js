(function(exports,metro,common,lazy,api,plugin){"use strict";function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),Constructor}function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var StorageManager=function(){function StorageManager2(options){if(_class_call_check(this,StorageManager2),_define_property(this,"_storage",void 0),_define_property(this,"_migrations",void 0),_define_property(this,"version",void 0),this._storage=options.storage,this.version=options.version,this._migrations=options.migrations,!this._storage.version){var newStorage=options.initialize();for(var key in newStorage)this._storage[key]=newStorage[key]}if(this.version<this._storage.version)throw new Error("The supported version is lower than the current storage version");this.version>this._storage.version&&this.migrate()}return _create_class(StorageManager2,[{key:"migrate",value:function(){for(var migrationStorage=this._storage,currentVersion=migrationStorage.version;currentVersion<this.version;currentVersion++){var migration=this._migrations[currentVersion];migrationStorage=migration(migrationStorage),migrationStorage.version=currentVersion+1}for(var key in migrationStorage)this._storage[key]=migrationStorage[key]}},{key:"set",value:function(path,value){for(var currentNode=this._storage,steps=path.split("."),i=0;i<steps.length;i++){var nextKey=steps[i];if(i===steps.length-1)currentNode[nextKey]=value;else if(nextKey in currentNode)currentNode=currentNode[nextKey];else{var node={};currentNode[nextKey]=node,currentNode=node}}return this}},{key:"get",value:function(path){var currentNode;for(var nextKey of path.split(".")){var node=currentNode??this._storage;if(nextKey in node)currentNode=node[nextKey];else return}return currentNode}},{key:"getFirstDefined",value:function(...paths){for(var path of paths){var value=this.get(path);if(value!==void 0)return value}}},{key:"setIfNotDefined",value:function(path,valueCb){return this.get(path)===void 0&&this.set(path,valueCb()),this}},{key:"unset",value:function(path){for(var currentNode,steps=path.split("."),i=0;i<steps.length;i++){var nextKey=steps[i];if(i===steps.length-1)return delete currentNode[nextKey],!0;var node=currentNode??this._storage;if(nextKey in node)currentNode=node[nextKey];else return!1}}}]),StorageManager2}(),findPropLazy=prop=>lazy.proxyLazy(()=>metro.findByPropsLazy(prop)[prop]);findPropLazy("inspect");var _a,color=metro.findByPropsLazy("SemanticColor");color?.default?.colors??common.constants?.ThemeColorMap,color?.default?.unsafe_rawColors??common.constants?.Colors,(_a=color.default).meta??(_a.meta=color.default.internal),metro.findByStoreNameLazy("ThemeStore"),findPropLazy("TextStyleSheet"),lazy.proxyLazy(()=>metro.findByPropsLazy("useSafeAreaInsets").SafeAreaView);var{Button,IconButton,TableRow,TableRowTrailingText,TableRowGroup,TableSwitchRow,TableSwitch,TableRadioRow,TableRadioGroup,TableCheckbox,TextInput}=metro.findByPropsLazy("Button","IconButton","TableRow");metro.findByProps("ActionSheet"),metro.findByProps("ActionSheetRow"),findPropLazy("BottomSheetTitleHeader"),lazy.lazyDestructure(()=>metro.findByPropsLazy("FormSwitch","FormRadio","FormCheckbox"));var Stack=findPropLazy("Stack");findPropLazy("FlashList");var storage=new StorageManager({storage:plugin.storage,initialize(){return{locale:"en-GB",version:1}},version:1,migrations:{}}),moment=lazy.proxyLazy(()=>metro.findByPropsLazy("isMoment")),locales=lazy.proxyLazy(()=>metro.findByPropsLazy("momentLocales").momentLocales),unpatches=[],momentSetLocale,index={onLoad:()=>{var origLocale=moment.locale();onLocaleUpdate(storage.get("locale")),unpatches.push(api.patcher.instead("locale",moment,(_,origFunc)=>void(momentSetLocale=origFunc)),api.patcher.instead("lang",moment,()=>{}),()=>momentSetLocale(origLocale))},onUnload:()=>{for(var unpatch of unpatches)unpatch()},settings:()=>{var savedLocale=storage.get("locale"),[_,forceUpdate]=React.useReducer(x=>~x,0);return onLocaleUpdate(savedLocale),React.createElement(common.ReactNative.ScrollView,{style:{flex:1}},React.createElement(Stack,{style:{paddingVertical:24,paddingHorizontal:12}},React.createElement(TableRadioGroup,{title:"Locales",value:savedLocale,onChange:value=>{storage.set("locale",value),forceUpdate()}},Object.keys(locales).map(locale=>React.createElement(TableRadioRow,{key:locale,label:locale,value:locale})))))}},onLocaleUpdate=newLocale=>{locales[newLocale]().then(()=>momentSetLocale(newLocale))};return exports.default=index,exports.storage=storage,Object.defineProperty(exports,"__esModule",{value:!0}),exports})({},bunny.metro,bunny.metro.common,bunny.utils.lazy,bunny.api,vendetta.plugin);
